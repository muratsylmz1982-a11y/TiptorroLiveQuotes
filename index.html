<!DOCTYPE html>
<html lang="de">
<head>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data: blob:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; script-src 'self' 'unsafe-inline'; connect-src 'self' https://shop.tiptorro.com https://docs.google.com; frame-src https://shop.tiptorro.com https://docs.google.com; object-src 'none'; base-uri 'self'; form-action 'self';">
  <!-- CSP: Removed unsafe-eval for better security, added Google Fonts explicitly -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TTQuotes - Live TV Config</title>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
<style>
  .badge{padding:4px 10px;border-radius:9999px;font-size:12px;font-weight:600;display:inline-block}
  .badge.green{background:#16a34a;color:#fff}
  .badge.gray{background:#6b7280;color:#fff}
  .action-btn.blue{background:#3b82f6;border-color:#2563eb}
  .action-btn.blue:hover{background:#2563eb}
</style>
</head>
<body>
  <div id="config-main">
    <!-- Header -->
    <div class="topbar">
      <div class="header-left">
        <img src="assets/logo2.png" alt="TTQuotes Logo" class="header-logo">
      </div>
      <div class="header-right">
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span>System Online</span>
        </div>
        <span id="display-count">0 TV-Ger&auml;te erkannt</span>
        <span id="allowlist-badge" class="badge gray" hidden>Allowlist</span>
      </div>
    </div>

    <div class="accent-bar"></div>
    <div class="config-section-title">Live TV Config</div>

    <div class="config-header">
      <div class="tv-counter" id="tv-counter">0 TV-Ger&auml;te konfiguriert</div>
    </div>

    <!-- Display-Konfiguration Container -->
    <div id="config-container">
      <!-- TV-Ger&auml;te werden hier dynamisch eingef&uuml;gt -->
    </div>

    <!-- Action Buttons -->
    <div class="actionbar">
      <div class="actions-group">
        <button class="action-btn gray toggle-btn">Auto-Start</button>
        <button class="action-btn" onclick="startApp()">LIVE-VIEWS STARTEN</button>
      </div>
      <div class="actions-group">
        <button class="action-btn gray" onclick="editFavorites()">FAVORITEN BEARBEITEN</button>
        <button class="action-btn blue" onclick="openHealthCheckDashboard()">&#127973; HEALTH CHECK</button>
        <button class="action-btn red" onclick="deleteConfig()">KONFIGURATION L&Ouml;SCHEN</button>
        <button class="action-btn red" onclick="quitApp()">BEENDEN</button>
        <button class="action-btn" onclick="window.location.href='extended-settings.html'">
          &#9881; ERWEITERTE EINSTELLUNGEN
        </button>
      </div>
    </div>
  </div>

  <!-- Favoriten Modal -->
  <div id="favorites-modal" class="modal-overlay">
    <div class="modal-content favorites-modal">
      <div class="modal-header">
        <h3>Favoriten bearbeiten</h3>
        <button class="close-button" type="button" id="close-favorites">&times;</button>
      </div>
      <div class="modal-body">
        <!-- NEU: Hinzuf&uuml;gen oben im Modal -->
        <div class="add-favorite-section">
          <div class="input-row">
            <input type="text" id="new-favorite-name" class="url-input" placeholder="Name eingeben" />
            <input type="url" id="new-favorite-url" class="url-input" placeholder="https://example.com" />
            <button class="btn green add-btn" type="button" id="add-favorite-btn">+ Hinzuf&uuml;gen</button>
          </div>
        </div>

        <!-- Favoriten-Liste -->
        <div class="favorites-section">
          <div id="favorites-list" class="favorites-list">
            <!-- Favoritenzeilen generiert das JS (siehe unten) -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Custom Confirm Modal (UI-Dialog f&uuml;r Best&auml;tigungen) -->
  <div id="custom-confirm-overlay" class="modal-overlay" style="display: none;">
    <div class="modal-content small-modal">
      <div class="modal-header">
        <h3 id="confirm-title">Achtung</h3>
      </div>
      <div class="modal-body">
        <div id="confirm-message" style="margin-bottom: 30px;">
          <!-- Die eigentliche Frage wird per JS gesetzt -->
        </div>
        <div style="display:flex;justify-content:center;gap:30px;">
          <button class="btn red" id="confirm-ok-btn">OK</button>
          <button class="btn gray" id="confirm-cancel-btn">Abbrechen</button>
        </div>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
  <script>
    async function initAutoStartBtn() {
      // waehlt per Klasse den ersten Button mit toggle-btn
      const btn = document.querySelector('.action-btn.toggle-btn');
      let enabled = await window.electronAPI.getAutostartStatus();
      // Startzustand: gruen wenn enabled, sonst grau
      btn.classList.toggle('green', enabled);
      btn.classList.toggle('gray', !enabled);

      btn.addEventListener('click', async () => {
        enabled = !enabled;
        const ok = await window.electronAPI.toggleAutostart(enabled);
        if (ok) {
          btn.classList.toggle('green', enabled);
          btn.classList.toggle('gray', !enabled);
        } else {
          console.error('Auto-Start konnte nicht umgestellt werden');
        }
      });
    }

    // Health Check Dashboard öffnen
    async function openHealthCheckDashboard() {
      try {
        const success = await window.electronAPI.invoke('open-health-check-dashboard');
        if (success) {
          console.log('Health Check Dashboard geöffnet');
        } else {
          alert('Fehler beim Öffnen des Health Check Dashboards');
        }
      } catch (error) {
        console.error('Fehler:', error);
        alert('Fehler: ' + error.message);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      initAutoStartBtn();
      // ... weitere Initialisierungen ...
    });
  </script>

  <div id="status-banner" class="status-banner" hidden>
    <div class="status-content">
      <span id="status-message"></span>
      <button id="status-close" class="status-close">&times;</button>
    </div>
  </div>
</body>
</html>
